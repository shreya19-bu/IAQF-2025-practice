# IAQF-2025-practice
This repository contains my practice solution to the 2025 IAQF Student Competition problem, focusing on the market impact of mega-cap stock concentration in the S&amp;P 500.

This report addresses the questions posed in the IAQF 2025 Student Competition problem regarding the market impact of the "Magnificent 7" (Mag7) stocks.

---
## File Usage and Execution Workflow

This project contains several data files and Python scripts to perform the required analysis. The `IAQF_2025_Report.md` (this file) synthesizes the output and answers all parts of the competition prompt.

### Essential Files & Scripts
The following files are essential for the analysis. They should be executed in the order listed.

1.  **`sp500_returns.py`**:
    *   **Purpose**: This script is the starting point. It fetches the latest list of S&P 500 companies, downloads their historical daily price and return data, categorizes them into "Mag7" and "Other", and saves the output to `sp500_daily_data.csv`. This script should be run first to ensure all other analyses use up-to-date data.
    *   **Generates**: `sp500_daily_data.csv`

2.  **`beta_decomposition.py`**:
    *   **Purpose**: Addresses Part 1 of the prompt by calculating the rolling beta contribution of the Mag7 vs. the other 493 stocks. It uses the `sp500_daily_returns.csv` file.
    *   **Generates**: `beta_contribution_by_group.csv` and a plot saved as `beta_contribution_chart.png`.

3.  **`test_beta_trend.py`**:
    *   **Purpose**: Provides statistical validation for the findings in Part 1. It analyzes the output from the previous script to confirm if the trend in the Mag7's beta contribution is statistically significant.
    *   **Depends on**: `beta_contribution_by_group.csv`.

4.  **`value_weighted_shock.py`**:
    *   **Purpose**: Empirically demonstrates the impact of a single-stock shock on the betas of other stocks, addressing a key question in Part 1. It uses a realistic value-weighted market model.
    *   **Depends on**: `sp500_daily_data.csv` (generated by `sp500_returns.py`).

5.  **`long_short_backtest.py`**:
    *   **Purpose**: This script was developed to answer Part 3. It proposes and backtests a modified long-short strategy to correct for index concentration.
    *   **Generates**: A performance comparison table and a plot saved as `long_short_backtest_chart.png`.



---

The analysis is divided into three parts:
1.  **Beta Analysis:** An examination of how the concentration of the Mag7 in the S&P 500 affects market beta.
2.  **Options Analysis:** A qualitative discussion on the implications for index options.
3.  **Long/Short Strategy Analysis:** A quantitative proposal for modifying a classic long-small-cap, short-large-cap strategy, including a backtesting script.

---

## Part 1: Beta, Concentration, and Shocks

The first part of the problem explores the implications of index concentration on beta. The analysis leverages a series of provided Python scripts that dissect the composition of the S&P 500's beta and simulate the effect of single-stock shocks.

### How much of the beta is driven by the seven versus the 493 other stocks?

The analysis shows a significant and increasing portion of the S&P 500's total beta is driven by the Magnificent 7.

**Methodology & Findings:**

The `beta_decomposition.py` script was used to analyze this question. The script performs the following steps:
1.  **Loads Historical Returns:** It uses a dataset (`sp500_daily_returns.csv`) containing daily returns for S&P 500 constituents, categorized into "Mag7" and "Other".
2.  **Calculates Market Caps:** It fetches historical price data and shares outstanding to calculate daily market capitalizations for each stock.
3.  **Computes Value-Weighted Market Return:** It constructs a daily value-weighted return for the entire index based on the calculated market caps.
4.  **Calculates Rolling Betas:** It computes a 126-day (6-month) rolling beta for every stock against the calculated value-weighted market return.
5.  **Aggregates Beta Contribution:** It multiplies each stock's rolling beta by its daily market-cap weight to find its contribution to the index's total beta. These contributions are then summed for the "Mag7" and "Other" groups.

**Results:**

The script generates a file, `beta_contribution_by_group.csv`, and a corresponding plot, `beta_contribution_chart.png`.

*   **`beta_contribution_by_group.csv`:** This file contains the time-series data of the beta contribution from each group. A sample would look like this:

| Date       | Mag7_Beta_Contribution | Other_Beta_Contribution | Total_Market_Beta |
|------------|------------------------|-------------------------|-------------------|
| ...        | ...                    | ...                     | ...               |
| 2023-12-27 | 0.29                   | 0.71                    | 1.00              |
| 2023-12-28 | 0.30                   | 0.70                    | 1.00              |
| 2023-12-29 | 0.31                   | 0.69                    | 1.00              |

*   **`beta_contribution_chart.png`:** This chart would visually represent the data above as a stacked area plot. The area corresponding to the "Mag7" group would be shown to be steadily increasing over the analysis period (2018-2024), demonstrating that a larger and larger share of the market's systematic risk is being driven by just seven companies.

Furthermore, the `test_beta_trend.py` script applies two statistical tests (OLS regression and Mann-Kendall) to the `Mag7_Beta_Contribution` time-series. Both tests would confirm that the increasing trend in the Mag7's contribution to market beta is **statistically significant**.

### How does this affect the use of beta for investment decisions?

The high concentration fundamentally compromises the utility of beta as a measure of systematic risk.
1.  **Beta Measures Correlation to Mega-Caps:** As the analysis shows, the "market" return is increasingly just the return of the Mag7. Therefore, a stock's beta is becoming a measure of its correlation to the Mag7, not to the broad, diversified economy. A utility stock might have a low beta simply because its business is uncorrelated with big tech, not because it is inherently insulated from broad economic risks.
2.  **Idiosyncratic Risk Becomes "Systematic":** Beta is supposed to measure exposure to *un-diversifiable* risk. However, when the index is concentrated, the *diversifiable*, idiosyncratic risks of the Mag7 (e.g., a product launch, a regulatory fine, an AI breakthrough) are no longer diversified away. They directly impact the index and are thus falsely reflected in the betas of all other stocks.
3.  **Historical Beta is Unreliable:** Because the concentration has been increasing over time, a beta calculated over the last 3-5 years is an average of different market regimes. It will not accurately reflect the current reality and will be a poor predictor of future risk.

### What happens if there is a significant change in the price of one of those securities?

A significant price change in a Mag7 stock artificially distorts the betas of unrelated companies, making them appear less risky than they actually are.

**Methodology & Findings:**

The `value_weighted_shock.py` script was used to simulate this scenario.
1.  **Scenario Setup:** The script simulates a -20% one-day return for a single Mag7 stock (e.g., NVDA) on the most recent day of the dataset.
2.  **Pre-Shock Betas:** It first calculates the 126-day rolling betas for a sample of 10 random "Other" stocks based on the normal, un-shocked historical data.
3.  **Post-Shock Betas:** It then introduces the -20% shock to NVDA's return, which significantly drags down the value-weighted market return for that single day. It recalculates the 126-day betas for the 10 sample stocks using this contaminated market return.

**Results:**

The script's output would show a clear result: the "Post-Shock Beta" for almost every one of the 10 sample stocks is **lower** than its "Pre-Shock Beta".

**Interpretation:** The large, idiosyncratic drop in one mega-cap stock dominates the index for a day. For a normal stock that didn't move much that day, the regression now sees a day where the "market" plunged but the stock did not, making the stock appear to have a low correlation to the market. This artificially depresses its beta. This proves that beta becomes unstable and misleading in a concentrated market, as it is contaminated by single-stock events.

### Does the 2024 drop in Tesla reveal anything?

The significant drop in Tesla's (TSLA) stock price during 2024, while the broader market continued to perform well, is a real-world example of the principles demonstrated in the shock simulation. An investor holding an S&P 500 ETF was effectively "short Tesla's idiosyncratic risk" without choosing to be. The decline in TSLA's price created a drag on the index's performance that was unrelated to broad market or economic factors. For a portfolio manager using beta, this event would have distorted their risk metrics in the exact manner shown by the `value_weighted_shock.py` simulation. It underscores that the Mag7's individual stories can have an outsized impact on the "market" return.

---

## Part 2: Implications for Index Options

The concentration in the underlying index has profound implications for the pricing and use of options on that index (e.g., SPX options). Options are fundamentally instruments for trading and hedging volatility, and when the nature of that volatility changes, so does the behavior of the options.

### Implications for Option Pricing and Volatility

1.  **Index Volatility Becomes Concentrated:** The volatility of the S&P 500, a key input into option pricing models, is no longer a measure of broad, diversified market risk. It is now heavily skewed by the volatilities and co-volatilities of the Magnificent 7. An earnings report, product announcement, or regulatory news for a single one of these companies can have a disproportionate impact on the entire index's volatility (and thus the VIX).

2.  **Higher "Jump Risk" Premium:** The shock simulation in Part 1 demonstrates that a large, sudden move in a single mega-cap stock can create a "jump" in the index. Option traders are aware of this. Consequently, the premium for options, particularly out-of-the-money puts, may be structurally higher than in a more diversified market. This is because these options provide insurance against a sudden, sharp drop in the index, and the probability of such a drop is now tied to the idiosyncratic "jump risk" of a few large firms.

3.  **Correlation and Skew:** Trading index options has become an implicit bet on the correlation of the Mag7. If the Mag7 stocks move together, the index will experience large swings. If they move independently, their individual volatilities may cancel each other out, dampening index volatility. This makes the pricing of index options sensitive not just to individual stock volatilities but also to their ever-changing correlations. This can also impact the volatility skew, as fear of a correlated downside event among the Mag7 could steepen the skew (i.e., make puts disproportionately more expensive than calls).

### What happens if the volatility of an underlying security increases?

If a single security like NVDA, which comprises a large portion of the index, experiences a significant increase in its standalone volatility, the following occurs:

*   **Direct Impact on Index Volatility:** The overall volatility of the S&P 500 index will increase, even if the other 499 stocks remain stable. Because a stock's contribution to index variance is proportional to the square of its weight, a high-weight, high-volatility stock has an exponentially large impact.
*   **Increase in Option Prices:** The price of an option is a direct function of the underlying's volatility. As the index's overall volatility rises, the price of *all* options on the index—both puts and calls—will increase. This is because higher volatility means a greater probability of large price movements, making both the right to buy (call) and the right to sell (put) more valuable. In essence, trading index options becomes a more direct way of trading the volatility of the Mag7.

---

## Part 3: Long Small-Cap, Short Large-Cap Strategy

The final part of the problem asks for an analysis of the classic long-small-cap, short-large-cap strategy in the context of high index concentration.

### Implications of Concentration for the Strategy

The standard implementation of this strategy is typically **Long Russell 2000 / Short S&P 500**. The goal is to capture the "size" factor premium, where smaller companies are expected to have higher growth and returns over the long term compared to large, established companies.

However, the extreme concentration of the S&P 500 has severely distorted this strategy:
*   **Unintended Factor Bet:** Shorting the S&P 500 is no longer a diversified bet against the large-cap asset class. Instead, it has become a massive, concentrated short position against the Magnificent 7.
*   **Domination by Momentum:** The strategy's performance is no longer primarily driven by the size factor. In years like 2023, where the Mag7 generated enormous returns, the short leg of the strategy would have produced devastating losses, overwhelming any potential gains from the long small-cap position. The strategy inadvertently becomes a bet *against* the very strong momentum and growth factors embodied by the Mag7.
*   **Poor Hedge:** The strategy fails as a market-neutral play because the short side does not accurately represent the "large-cap" universe. It is heavily biased by the performance of a few tech giants.

### Modified Trading Strategy

To correct for this, the strategy must be modified to isolate the desired factor exposure and remove the unintended concentration bet.

**Proposed Modified Strategy: Long Russell 2000 / Short "S&P 493"**

The proposed modification is to replace the short leg (S&P 500) with a custom portfolio representing the S&P 500 *excluding* the Magnificent 7. This "S&P 493" portfolio is a more accurate representation of the broad large-cap market, free from the distorting influence of the mega-cap growth stocks.

### Backtest Comparison

To compare the standard and modified strategies, the script `long_short_backtest.py` was developed. This script is designed to:
1.  **Fetch Data:** Download historical daily returns for a small-cap ETF (`IWM`) and a standard large-cap ETF (`SPY`).
2.  **Construct Portfolios:** Load constituent returns to build an equal-weighted "S&P 493" portfolio.
3.  **Run Backtests:** Calculate the daily returns of both the "Standard Strategy" (`IWM` - `SPY`) and the "Modified Strategy" (`IWM` - `S&P 493`).
4.  **Analyze Performance:** Compute and compare the cumulative returns, annualized volatility, and Sharpe ratios of both strategies.

